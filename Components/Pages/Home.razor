@page "/"
@using System.Security.Cryptography
@using GroupOrder.Data
@using Microsoft.EntityFrameworkCore

@inject IDbContextFactory<GroupContext> DbFactory
@inject NavigationManager NavigationManager


<PageTitle>Mamp.Link</PageTitle>

Welcome to Mamp.Link!<br/>
Create a new Group here or use an link to join an existing one.<br/><br/>


<form method="post" @onsubmit="Submit" @formname="group-create-form">
    <AntiforgeryToken />
    <div>
        <label>
            Name:
            <InputText @bind-Value="Model!.GroupName" />
        </label>
    </div>
    <div>
        <button type="submit">Submit</button>
    </div>
</form>

@code {
    [SupplyParameterFromForm] public Group? Model { get; set; }

    protected override void OnInitialized() => Model ??= new();

    private void Submit()
    {
        using var context = DbFactory.CreateDbContext();
        Model!.AdminCode = RandomNumberGenerator.GetHexString(10);
        Model!.GroupSlug = RandomNumberGenerator.GetHexString(10);
        context.Add(Model);
        context.SaveChanges();
        
        NavigationManager.NavigateTo($"/group/{Model!.GroupSlug}?admin={Model!.AdminCode}");
    }

}
